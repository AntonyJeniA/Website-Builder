<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug - Visual Web Builder</title>
    <link rel="stylesheet" href="styles/main.css">
</head>
<body>
    <!-- Skip link for accessibility -->
    <a href="#main-canvas" class="vwb-skip-link">Skip to main content</a>
    
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <h1>Visual Web Builder (Debug Mode)</h1>
            <div class="header-controls" role="toolbar" aria-label="Main actions">
                <button id="save-btn" class="btn btn-primary" aria-label="Save project (Ctrl+S)">Save</button>
                <button id="load-btn" class="btn btn-secondary" aria-label="Load project (Ctrl+O)">Load</button>
                <button id="export-btn" class="btn btn-secondary" aria-label="Export HTML/CSS (Ctrl+E)">Export</button>
                <button id="preview-window-btn" class="btn btn-secondary" aria-label="Open preview in new window (Ctrl+Shift+P)">Preview Window</button>
                <button id="demo-btn" class="btn btn-accent" aria-label="Toggle demo mode (F5)">Demo</button>
            </div>
        </header>

        <!-- Main three-panel layout -->
        <main class="main-content">
            <!-- Left Panel - Element Library -->
            <aside class="left-panel" id="element-library">
                <h2>Elements</h2>
                <div class="element-categories">
                    <div class="category">
                        <h3>Layout</h3>
                        <div class="element-list" id="layout-elements">
                            <!-- Elements will be populated by JavaScript -->
                        </div>
                    </div>
                    <div class="category">
                        <h3>Text</h3>
                        <div class="element-list" id="text-elements">
                            <!-- Elements will be populated by JavaScript -->
                        </div>
                    </div>
                    <div class="category">
                        <h3>Form</h3>
                        <div class="element-list" id="form-elements">
                            <!-- Elements will be populated by JavaScript -->
                        </div>
                    </div>
                    <div class="category">
                        <h3>Media</h3>
                        <div class="element-list" id="media-elements">
                            <!-- Elements will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Center Panel - Canvas -->
            <section class="center-panel">
                <div class="canvas-toolbar">
                    <div class="viewport-controls" role="radiogroup" aria-label="Viewport size selection">
                        <button class="viewport-btn active" data-viewport="desktop" role="radio" aria-checked="true" aria-label="Desktop viewport (Ctrl+1)">Desktop</button>
                        <button class="viewport-btn" data-viewport="tablet" role="radio" aria-checked="false" aria-label="Tablet viewport (Ctrl+2)">Tablet</button>
                        <button class="viewport-btn" data-viewport="mobile" role="radio" aria-checked="false" aria-label="Mobile viewport (Ctrl+3)">Mobile</button>
                    </div>
                </div>
                <div class="canvas-container">
                    <div class="canvas" id="main-canvas">
                        <!-- User-created elements will be rendered here -->
                    </div>
                </div>
            </section>

            <!-- Right Panel - Properties -->
            <aside class="right-panel" id="property-editor">
                <h2>Properties</h2>
                <div class="property-sections">
                    <div class="no-selection-message">
                        <p>Select an element to edit its properties</p>
                    </div>
                    <div class="property-content" style="display: none;">
                        <!-- Property controls will be populated by JavaScript -->
                    </div>
                </div>
            </aside>
        </main>
    </div>

    <!-- Debug Script - Load files one by one -->
    <script>
        console.log('=== Debug Mode - Loading JavaScript Files ===');
        
        function loadScript(src, callback) {
            console.log('Loading:', src);
            var script = document.createElement('script');
            script.src = src;
            script.onload = function() {
                console.log('‚úì Loaded:', src);
                if (callback) callback();
            };
            script.onerror = function() {
                console.error('‚úó Failed to load:', src);
                if (callback) callback(new Error('Failed to load ' + src));
            };
            document.head.appendChild(script);
        }
        
        // Load scripts in sequence
        var scripts = [
            'js/utils/EventBus.js',
            'js/utils/DOMUtils.js',
            'js/core/ErrorHandler.js',
            'js/core/FallbackManager.js',
            'js/core/PanelManager.js',
            'js/core/ElementLibrary.js',
            'js/core/DragDropEngine.js',
            'js/core/CanvasManager.js',
            'js/core/PropertyEditor.js',
            'js/core/PreviewManager.js',
            'js/core/StorageManager.js',
            'js/core/ExportEngine.js',
            'js/core/ResponsiveManager.js',
            'js/core/AdvancedManipulation.js',
            'js/core/UXEnhancement.js',
            'js/core/VisualWebBuilder.js'
        ];
        
        var currentIndex = 0;
        
        function loadNext(error) {
            if (error) {
                console.error('Script loading failed:', error);
                return;
            }
            
            if (currentIndex >= scripts.length) {
                console.log('All scripts loaded successfully!');
                initializeApp();
                return;
            }
            
            loadScript(scripts[currentIndex], function(err) {
                currentIndex++;
                loadNext(err);
            });
        }
        
        function initializeApp() {
            console.log('=== Initializing Application ===');
            
            try {
                // Test EventBus
                console.log('Testing EventBus...');
                var eventBus = new EventBus();
                console.log('‚úì EventBus created');
                
                // Test VisualWebBuilder
                console.log('Testing VisualWebBuilder...');
                var app = new VisualWebBuilder();
                console.log('‚úì VisualWebBuilder created');
                
                // Initialize
                console.log('Initializing VisualWebBuilder...');
                app.init();
                console.log('‚úì VisualWebBuilder initialized');
                
                // Make globally available
                window.visualWebBuilder = app;
                
                console.log('üéâ Application initialized successfully!');
                
            } catch (error) {
                console.error('‚ùå Application initialization failed:', error);
                console.error('Error stack:', error.stack);
                
                // Show error details
                var errorDiv = document.createElement('div');
                errorDiv.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #f8d7da; color: #721c24; padding: 1rem; border-radius: 4px; max-width: 400px; z-index: 10000; font-family: monospace; font-size: 12px;';
                errorDiv.innerHTML = '<strong>Debug Error:</strong><br>' + error.message + '<br><br><strong>Stack:</strong><br>' + (error.stack || 'No stack trace');
                document.body.appendChild(errorDiv);
            }
        }
        
        // Start loading
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, starting script loading...');
            loadNext();
        });
    </script>
</body>
</html>